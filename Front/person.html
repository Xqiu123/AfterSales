<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人中心</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        .head {
            background-color: #333;
            display: flex;
            height: 80px;
            align-items: center;
        }

        .icon {
            margin-left: 30px;
        }

        .icon img {
            width: 40px;
        }

        .txt {
            color: white;
            font-weight: 700;
            font-size: 40px;
            margin: 0 auto;
            height: 60px;
            width: 200px;
        }

        .txt1 {
            color: white;
            width: 200px;
        }

        .sidebar {
            width: 250px;
            color: #fff;
            position: fixed;
            overflow-y: auto;
        }

        .sidebar a {
            padding: 10px 20px;
            text-decoration: none;
            color: black;
            display: flex;
            align-items: center;
            transition: background-color 0.3s;
            height: 80px;
            font-size: 20px;
        }

        .sidebar a:hover {
            background-color: white;
            border: 1px solid #cdcdcd;
        }

        .sidebar a img {
            height: 30px;
            margin-right: 10px;
            margin-left: 20px;
        }

        .content {
            margin-left: 250px;
        }

        .me {
            margin-left: 120px;
            margin-top: 120px;
            width: 400px;
            display: flex;
            flex-wrap: wrap;
            border: 1px solid #BBBBBB;
            background-color: rgba(255, 255, 255, 0.6);
        }

        .lis img {
            width: 25px;
            margin-right: 10px;
        }

        .lis {
            align-items: center;
            display: flex;
            width: 400px;
            height: 80px;
            font-size: 20px;
            background-color: rgba(255, 255, 255, 0.6);
            padding-left: 20px;
        }

        .alter {
            display: flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.6);
            width: 400px;
            height: 400px;
            font-size: 20px;
            margin-left: 100px;
            border: 1px solid #BBBBBB;
            margin-top: 100px;
        }

        .alter form table tr {
            height: 60px;
        }

        .td {
            padding-left: 50px;
        }

        .btn {
            margin-top: 20px;
            color: white;
            margin-left: 100px;
            width: 60px;
            height: 30px;
            border: none;
        }

        .body {
            margin-left: 10px;
            width: 200px;
            height: 30px;
            font-size: 15px;
            padding-left: 10px;
            border: 1px solid #BBBBBB;
        }

        .body:focus {
            outline: none;
        }


        .order {
            border-collapse: collapse;
            margin-top: 100px;
            margin-left: 150px;
            background-color: rgba(255, 255, 255, 0.7);

        }

        .cell2 {
            padding: 8px;
            text-align: center;
            border: 1px solid #BBBBBB;
            height: 60px;
            width: 150px;
        }

        .title2 {
            width: 150px;
            height: 60px;
            background-color: #BBBBBB;
            border: 1px solid #A8A8A8;
        }

        .change2 {
            display: flex;
            justify-content: center;
            width: 833px;
            height: 60px;
            display: block;
            background-color: rgba(255, 255, 255, 0.7);
            position: absolute;
            bottom: 103px;
            left: 400px;
        }

        .num2 {
            margin-left: 10px;
            margin-right: 10px;
            font-size: 20px;
            margin-top: 15px;
        }

        .btn2 {
            margin-top: 15px;
            width: 80px;
            height: 30px;
            font-size: 15px;
            background-color: #4095E5;
            color: white;
            border: 0;
            border-radius: 5px;
        }


        .maintain {
            border-collapse: collapse;
            margin-top: 100px;
            margin-left: 150px;
            background-color: rgba(255, 255, 255, 0.7);
        }

        .cell3 {
            padding: 8px;
            text-align: center;
            border: 1px solid #BBBBBB;
            height: 60px;
            width: 150px;
        }

        .title3 {
            width: 150px;
            height: 60px;
            background-color: #BBBBBB;
            border: 1px solid #A8A8A8;
        }

        .change3 {
            display: flex;
            justify-content: center;
            width: 833px;
            height: 60px;
            display: block;
            background-color: rgba(255, 255, 255, 0.7);
            position: absolute;
            bottom: 103px;
            left: 400px;
        }

        .num3 {
            margin-left: 10px;
            margin-right: 10px;
            font-size: 20px;
            margin-top: 15px;
        }

        .btn3 {
            margin-top: 15px;
            width: 80px;
            height: 30px;
            font-size: 15px;
            background-color: #4095E5;
            color: white;
            border: 0;
            border-radius: 5px;
        }


        .drive {
            border-collapse: collapse;
            margin-top: 100px;
            margin-left: 150px;
            background-color: rgba(255, 255, 255, 0.7);
        }

        .cell4 {
            padding: 8px;
            text-align: center;
            border: 1px solid #BBBBBB;
            height: 60px;
            width: 150px;
        }

        .title4 {
            width: 150px;
            height: 60px;
            background-color: #BBBBBB;
            border: 1px solid #A8A8A8;
        }

        .change4 {
            display: flex;
            justify-content: center;
            width: 833px;
            height: 60px;
            display: block;
            background-color: rgba(255, 255, 255, 0.7);
            position: absolute;
            bottom: 103px;
            left: 400px;
        }

        .num4 {
            margin-left: 10px;
            margin-right: 10px;
            font-size: 20px;
            margin-top: 15px;
        }

        .btn4 {
            margin-top: 15px;
            width: 80px;
            height: 30px;
            font-size: 15px;
            background-color: #4095E5;
            color: white;
            border: 0;
            border-radius: 5px;
        }


        .collect {
            border-collapse: collapse;
            margin-top: 100px;
            margin-left: 150px;
            background-color: rgba(255, 255, 255, 0.7);
        }

        .cell5 {
            padding: 8px;
            text-align: center;
            border: 1px solid #BBBBBB;
            height: 60px;
            width: 150px;
        }

        .title5 {
            width: 150px;
            height: 60px;
            background-color: #BBBBBB;
            border: 1px solid #A8A8A8;
        }

        .change5 {
            display: flex;
            justify-content: center;
            width: 833px;
            height: 60px;
            display: block;
            background-color: rgba(255, 255, 255, 0.7);
            position: absolute;
            bottom: 103px;
            left: 400px;
        }

        .num5 {
            margin-left: 10px;
            margin-right: 10px;
            font-size: 20px;
            margin-top: 15px;
        }

        .btn5 {
            margin-top: 15px;
            width: 80px;
            height: 30px;
            font-size: 15px;
            background-color: #4095E5;
            color: white;
            border: 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div>
    <img src="static/asset/img/系统组件及背景图/9.用户个人中心/背景图-用户个人中心.png" class="back" height="100%" width="100%"
         style="z-index: -1; position: fixed; opacity: 60%"/>
</div>
<div class="head">
    <div class="icon"><img src="static/asset/img/系统组件及背景图/9.用户个人中心/左箭头.png"></div>
    <div class="txt">个人中心</div>
    <div class="txt1">你好，可可西里</div>
</div>

<div class="main" id="main">
    <div class="sidebar">
        <a href="#" @click="showContent('page1','li1')" style="background-color: white" id="li1">
            <img src="static/asset/img/系统组件及背景图/9.用户个人中心/个人信息.png">
            个人信息
        </a>
        <a href="#" @click="showContent('page2','li2')" id="li2">
            <img src="static/asset/img/系统组件及背景图/9.用户个人中心/我的订单.png">
            我的订单
        </a>
        <a href="#" @click="showContent('page3','li3')" id="li3">
            <img src="static/asset/img/系统组件及背景图/9.用户个人中心/维修申请.png">
            维修申请
        </a>
        <a href="#" @click="showContent('page4','li4')" id="li4">
            <img src="static/asset/img/系统组件及背景图/9.用户个人中心/试驾预约.png">
            试驾预约
        </a>
        <a href="#" @click="showContent('page5','li5')" id="li5">
            <img src="static/asset/img/系统组件及背景图/9.用户个人中心/我的收藏.png">
            我的收藏
        </a>
    </div>

    <div class="content">
        <!--        个人信息-->
        <div id="page1" style="display: flex; align-items: center;">
            <div class="me">
                <div class="lis">
                    <img src="static/asset/img/系统组件及背景图/10.用户中心-个人信息/昵称.png">
                    昵称：&nbsp;可可西里
                </div>
                <div class="lis">
                    <img src="static/asset/img/系统组件及背景图/10.用户中心-个人信息/性别.png">
                    性别：&nbsp;女
                </div>
                <div class="lis">
                    <img src="static/asset/img/系统组件及背景图/10.用户中心-个人信息/手机号.png">
                    绑定手机号：&nbsp;17377777777
                </div>

            </div>
            <div class="alter">
                <form>
                    <table>
                        <tr>
                            <td class="td">昵称</td>
                            <td><input type="text" class="body" id="name" placeholder="请输入昵称"></td>
                        </tr>
                        <tr>
                            <td class="td">性别</td>
                            <td>
                                <input type="radio" name="gender" value="male"> 男性
                                <input type="radio" name="gender" value="male"> 女性
                            </td>
                        </tr>
                        <tr>
                            <td class="td">密码</td>
                            <td><input type="text" class="body" id="code1"></td>
                        </tr>
                        <tr>
                            <td class="td">确认密码</td>
                            <td><input type="text" class="body" id="code2"></td>
                        </tr>

                    </table>
                    <button id="alter" type="submit" class="btn" style="background-color:rgb(31,106,204); ">修改</button>
                    <button id="quit" type="submit" class="btn" style="background-color:rgb(175,32,58);">退出</button>
                </form>
            </div>
        </div>
        <!--        我的订单-->
        <div id="page2" style="display: none;" class="page2">
            <div id="tableContainer2"></div>
            <div class="change2">
                <button onclick="previousPage2()" class="btn2" style="margin-left: 300px">上一页</button>
                <span id="current2" class="num2">1</span>
                <button onclick="nextPage2()" class="btn2">下一页</button>
            </div>

        </div>

        <!--        维修申请-->
        <div id="page3" style="display: none;">
            <div id="tableContainer3"></div>
            <div class="change3">
                <button onclick="previousPage3()" class="btn3" style="margin-left: 300px">上一页</button>
                <span id="current3" class="num3">1</span>
                <button onclick="nextPage3()" class="btn3">下一页</button>
            </div>
        </div>
        <!--        试驾预约-->
        <div id="page4" style="display: none;">
            <div id="tableContainer4"></div>
            <div class="change4">
                <button onclick="previousPage4()" class="btn4" style="margin-left: 300px">上一页</button>
                <span id="current4" class="num4">1</span>
                <button onclick="nextPage4()" class="btn4">下一页</button>
            </div>
        </div>
        <!--        我的收藏-->
        <div id="page5" style="display: none;">
            <div id="tableContainer5"></div>
            <div class="change5">
                <button onclick="previousPage5()" class="btn5" style="margin-left: 300px">上一页</button>
                <span id="current5" class="num5">1</span>
                <button onclick="nextPage5()" class="btn5">下一页</button>
            </div>
        </div>

    </div>
</div>

<script src="vue.js"></script>
<script>


    const app = new Vue({
        el: '#main',
        data: {},
        methods: {
            showContent(pageId, liId) {
                var sidebar = document.querySelectorAll('.sidebar > a');
                var pages = document.querySelectorAll('.content > div');
                pages.forEach(function (page) {
                    if (page.id === pageId) {
                        page.style.display = 'flex';
                    } else {
                        page.style.display = 'none';
                    }
                });
                sidebar.forEach(function (li) {
                    if (li.id === liId) {
                        li.style.backgroundColor = 'white';
                    } else {
                        li.style.backgroundColor = 'rgb(255,255,255,0.00000001)';
                    }
                })
            }

        }
    })

    var alter = document.getElementById('alter');
    // 修改个人信息
    alter.onclick = function () {
        var name = document.getElementById('name').value;
        var gender = document.querySelector('input[name="gender"]:checked');
        var code1 = document.getElementById('code1').value;
        var code2 = document.getElementById('code2').value;

        if (code1 != code2) {
            alert('密码不匹配，请重新输入');
            return;
        }

        Fetch('/user', 'put', JSON.stringify({
            name: name,
            gender: gender,
            password: code1
        })).then(res => {
            // token = res.token
            // msg = res.msg

            if (!token) { // 密码错误
                console.log("密码错误")
                alert("密码错误")
            } else {
                // 储存token
                console.log(token)
                localStorage.setItem('token', token)
                // 跳转
                self.location = 'person.html';
            }
        })
    }
    // // 退出登录
    // document.getElementById('quit').addEventListener('click', function () {
    //     fetch('/logout', {
    //         method: 'POST',
    //         // 如果使用了身份验证令牌或cookie，确保包含在请求中
    //         credentials: 'include', // 对于cookies
    //         headers: {
    //             'Content-Type': 'application/json',
    //             // 'Authorization': 'Bearer ' + token // 对于令牌
    //         }
    //     })
    //         .then(response => {
    //             if (response.ok) {
    //                 // 成功退出后的逻辑，比如跳转到登录页或显示成功消息
    //                 window.location.href = '/login'; // 重定向到登录页面
    //             } else {
    //                 // 处理错误情况
    //                 console.error('退出失败');
    //             }
    //         })
    //         .catch(error => {
    //             // 网络或其他错误处理
    //             console.error('请求错误', error);
    //         });
    // });


    var pageSize = 5;
    var data = [
        // 示例数据
        {"brand": "Alice", "name": 25, "price": 1111, "color": "黑色", "style": "前驱"},
        {"brand": "Bob", "name": 24, "price": 2222, "color": "白色", "style": "前驱"},
        {"brand": "Bob", "name": 24, "price": 2222, "color": "白色", "style": "前驱"},
        {"brand": "Bob", "name": 24, "price": 2222, "color": "白色", "style": "前驱"},
        {"brand": "Bob", "name": 24, "price": 2222, "color": "白色", "style": "前驱"},
        {"brand": "Bob", "name": 24, "price": 2222, "color": "白色", "style": "前驱"},
        {"brand": "Bob", "name": 24, "price": 2222, "color": "白色", "style": "前驱"},
        {"brand": "Bob", "name": 24, "price": 2222, "color": "白色", "style": "前驱"},
        {"brand": "Bob", "name": 24, "price": 2222, "color": "白色", "style": "前驱"},
        {"brand": "Bob", "name": 24, "price": 2222, "color": "白色", "style": "前驱"}
        // ...更多数据
    ];

    // 我的订单
    var current2 = 1;
    // 获取订单列表
    var orderList;
    Fetch('/application/list', 'get', null).then(res => {
        console.log(res.data);
        applyList = res.data.drive;
        console.log(applyList);
    });
    function renderTable2(page) {
        var start = (page - 1) * pageSize;
        var end = start + pageSize;
        var slicedData = data.slice(start, end);

        var table = '<table class="order"><tr><th class="title2">品牌</th><th class="title2">车型</th><th class="title2">厂商指导价</th><th class="title2">颜色</th><th class="title2">驱动方式</th></tr>';
        slicedData.forEach(function (row) {
            table += '<tr><td class="cell2">' + row.brand + '</td><td class="cell2">' + row.name + '</td><td class="cell2">' + row.price + '</td><td class="cell2">' + row.color + '</td><td class="cell2">' + row.style + '</td></tr>';
        });
        table += '</table>';

        document.getElementById('tableContainer2').innerHTML = table;
        document.getElementById('current2').innerText = current2;
    }

    function previousPage2() {
        if (current2 > 1) {
            current2 -= 1;
            renderTable2(current2);
        }
    }

    function nextPage2() {
        if ((current2 * pageSize) < data.length) {
            current2 += 1;
            renderTable2(current2);
        }
    }

    // 初始渲染
    renderTable2(current2);

    // 获取维修申请和试驾预约列表
    var applyList;
    Fetch('/application/list', 'get', null).then(res => {
        console.log(res.data);
        applyList = res.data.repair;
        console.log(applyList);
    });

    // 维修申请
    var current3 = 1;

    function renderTable3(page) {
        var start = (page - 1) * pageSize;
        var end = start + pageSize;
        var slicedData = applyList.slice(start, end);

        var table = '<table class="maintain"><tr><th class="title3">车型</th><th class="title3">空闲时间</th><th class="title3">服务类型</th><th class="title3">处理状态</th></tr>';
        slicedData.forEach(function (row) {
            var status;
            var detail;
            Fetch('/car/info', 'get', JSON.stringify({
                id: row.car_id,
            })).then(res => {
                detail = res.data;

            });
            if (row.is_end === 0) {
                status = '未完成';
            } else {
                status = '已完成';
            }
            table += '<tr><td class="cell3">' + detail.name + '</td><td class="cell3">' + row.name + '</td><td class="cell3">' + row.description + '</td><td class="cell3">' + status + '</td></tr>';
        });
        table += '</table>';

        document.getElementById('tableContainer3').innerHTML = table;
        document.getElementById('current3').innerText = current3;
    }

    function previousPage3() {
        if (current3 > 1) {
            current3 -= 1;
            renderTable3(current3);
        }
    }

    function nextPage3() {
        if ((current3 * pageSize) < applyList.length) {
            current3 += 1;
            renderTable3(current3);
        }
    }

    // 初始渲染
    renderTable3(current3);


    // 试驾预约
    var current4 = 1;

    function renderTable4(page) {
        var start = (page - 1) * pageSize;
        var end = start + pageSize;
        var slicedData = applyList.slice(start, end);

        var table = '<table class="drive"><tr><th class="title4">车型</th><th class="title4">空闲时间</th><th class="title4">预约状态</th></tr>';
        slicedData.forEach(function (row) {
            var status;
            var detail;
            Fetch('/car/info', 'get', JSON.stringify({
                id: row.car_id,
            })).then(res => {
                detail = res.data;

            });
            if (row.is_end === 0) {
                status = '未完成';
            } else {
                status = '已完成';
            }
            table += '<tr><td class="cell4">' + detail.name + '</td><td class="cell4">' + row.time + '</td><td class="cell4">' + status + '</td></tr>';
        });
        table += '</table>';

        document.getElementById('tableContainer4').innerHTML = table;
        document.getElementById('current4').innerText = current4;
    }

    function previousPage4() {
        if (current4 > 1) {
            current4 -= 1;
            renderTable4(current4);
        }
    }

    function nextPage4() {
        if ((current4 * pageSize) < applyList.length) {
            current4 += 1;
            renderTable4(current4);
        }
    }

    // 初始渲染
    renderTable4(current4);


    // 我的收藏
    var current5 = 1;

    function renderTable5(page) {
        var start = (page - 1) * pageSize;
        var end = start + pageSize;
        var slicedData = data.slice(start, end);

        var table = '<table class="drive"><tr><th class="title5">车型</th><th class="title5">空闲时间</th><th class="title5">预约状态</th><th class="title5">空闲时间</th><th class="title5">预约状态</th></tr>';
        slicedData.forEach(function (row) {
            table += '<tr><td class="cell5">' + row.brand + '</td><td class="cell5">' + row.name + '</td><td class="cell5">' + row.price + '</td><td class="cell5">' + row.name + '</td><td class="cell5">' + row.price + '</td></tr>';
        });
        table += '</table>';

        document.getElementById('tableContainer5').innerHTML = table;
        document.getElementById('current5').innerText = current5;
    }

    function previousPage5() {
        if (current5 > 1) {
            current5 -= 1;
            renderTable5(current5);
        }
    }

    function nextPage5() {
        if ((current5 * pageSize) < data.length) {
            current5 += 1;
            renderTable5(current5);
        }
    }

    // 初始渲染
    renderTable5(current5);

    async function Fetch(path, method, body) {
        return await fetch('http://127.0.0.1:8080/api/v1' + path, {
            method: method,
            headers: {
                'Content-Type': 'application/json;charset=utf-8',
                'Authorization': localStorage.getItem('token')
            },
            body: body,
        }).then(res => {
            return res.json()
        })
    }
</script>
</body>
</html>
